(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{811:function(s,a,e){"use strict";e.r(a);var t=e(114),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"测试环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试环境"}},[s._v("#")]),s._v(" 测试环境")]),s._v(" "),e("h2",{attrs:{id:"两台服务器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#两台服务器"}},[s._v("#")]),s._v(" 两台服务器")]),s._v(" "),e("p",[s._v("分别模拟云端和本地window")]),s._v(" "),e("ul",[e("li",[s._v("云端: 8.210.238.93")]),s._v(" "),e("li",[s._v("本地:")])]),s._v(" "),e("h2",{attrs:{id:"云端-8-210-238-93"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#云端-8-210-238-93"}},[s._v("#")]),s._v(" 云端: 8.210.238.93")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("PORTS")]),s._v(" "),e("th",{staticStyle:{"text-align":"right"}},[s._v("NAMES")])])]),s._v(" "),e("tbody",[e("tr",[e("td"),s._v(" "),e("td",{staticStyle:{"text-align":"right"}},[s._v("kafka_sync_mongo")])]),s._v(" "),e("tr",[e("td",[s._v("0.0.0.0:80->7033/tcp")]),s._v(" "),e("td",{staticStyle:{"text-align":"right"}},[s._v("energy")])]),s._v(" "),e("tr",[e("td"),s._v(" "),e("td",{staticStyle:{"text-align":"right"}},[s._v("check-mongo-online")])]),s._v(" "),e("tr",[e("td"),s._v(" "),e("td",{staticStyle:{"text-align":"right"}},[s._v("check-mongo-local")])]),s._v(" "),e("tr",[e("td",[s._v("0.0.0.0:37017->27017/tcp")]),s._v(" "),e("td",{staticStyle:{"text-align":"right"}},[s._v("energydb1")])]),s._v(" "),e("tr",[e("td",[s._v("0.0.0.0:27017->9092/tcp")]),s._v(" "),e("td",{staticStyle:{"text-align":"right"}},[s._v("kafka-docker_kafka_1")])]),s._v(" "),e("tr",[e("td",[s._v("22/tcp, 2888/tcp, 3888/tcp, 0.0.0.0:2181->2181/tcp")]),s._v(" "),e("td",{staticStyle:{"text-align":"right"}},[s._v("kafka-docker_zookeeper_1")])])])]),s._v(" "),e("h3",{attrs:{id:"kafka"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kafka"}},[s._v("#")]),s._v(" kafka")]),s._v(" "),e("ul",[e("li",[s._v("kafka-docker_kafka_1")]),s._v(" "),e("li",[s._v("kafka-docker_zookeeper_1")])]),s._v(" "),e("div",{staticClass:"language-yml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker-compose.yml")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.9'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("zookeeper")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wurstmeister/zookeeper\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2181:2181"')]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kafka")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wurstmeister/kafka\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" zookeeper\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"27017:9092"')]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("KAFKA_ADVERTISED_HOST_NAME")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 8.210.238.93\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("KAFKA_ZOOKEEPER_CONNECT")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" zookeeper"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2181")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /var/run/docker.sock"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/run/docker.sock\n")])])]),e("h3",{attrs:{id:"kafka-server-test"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kafka-server-test"}},[s._v("#")]),s._v(" kafka server test")]),s._v(" "),e("ul",[e("li",[s._v("8.210.238.93")]),s._v(" "),e("li",[s._v("172.31.0.6")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bash")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -i /Users/hemiao/pem/me.pem root@8.210.238.93\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Install Docker")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -i /Users/hemiao/pem/me.pem /Users/hemiao/fusquare/projects/swire/energy/docs/fun/docker.sh root@8.210.238.93:/root\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" docker.sh\n./docker.sh\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker-compose")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://github.com/docker/compose/releases/download/1.27.4/docker-compose-'),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -s"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("-"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -m"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" -o /usr/local/bin/docker-compose\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/docker-compose\ndocker-compose --version\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kafka-docker")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://github.com/wurstmeister/kafka-docker")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -i /Users/hemiao/pem/me.pem -r /Users/hemiao/temp/kafka-docker/ root@8.210.238.93:/root\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://www.jianshu.com/p/0edcc3addf3f")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" kafka-docker\ndocker-compose up -d\ndocker-compose stop\n\ndocker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it kafka-docker_kafka_1 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 创建 topic")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KAFKA_HOME")]),s._v("/bin/kafka-topics.sh --create --topic swire --partitions "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" --zookeeper kafka-docker_zookeeper_1:2181 --replication-factor "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KAFKA_HOME")]),s._v("/bin/kafka-topics.sh --create --topic msg --partitions "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" --zookeeper kafka-docker_zookeeper_1:2181 --replication-factor "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看刚刚创建的topic")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KAFKA_HOME")]),s._v("/bin/kafka-topics.sh --zookeeper kafka-docker_zookeeper_1:2181 --describe --topic swire\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KAFKA_HOME")]),s._v("/bin/kafka-topics.sh --zookeeper kafka-docker_zookeeper_1:2181 --describe --topic msg\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # 发布信息")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $KAFKA_HOME/bin/kafka-console-producer.sh --topic=topic --broker-list kafka-docker_kafka_1:9092")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# >ni")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# >haha")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # 接收消息")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $KAFKA_HOME/bin/kafka-console-consumer.sh --bootstrap-server kafka-docker_kafka_1:9092 --from-beginning --topic topic")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # kafka集群管理界面")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# docker run -itd --name=kafka-manager -p 9000:9000 -e ZK_HOSTS="8.210.238.93:2181" sheepkiller/kafka-manager')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 8.210.238.93:9000")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# docker container stop $(docker container ls -a -q -f "label=io.confluent.docker")')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 释放硬盘空间")]),s._v("\ndocker system prune -a -f --volumes\ndocker system prune -a --volumes\n")])])]),e("h3",{attrs:{id:"energydb1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#energydb1"}},[s._v("#")]),s._v(" energydb1")]),s._v(" "),e("div",{staticClass:"language-mongo extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('ssh -i /Users/hemiao/pem/me.pem root@8.210.238.93\n\ndocker run -d -p 27017:27017 -v /"$PWD"/backups:/backups --name energydb -e MONGO_INITDB_ROOT_USERNAME=GDPfcXs6IkpMTgZ8yys -e MONGO_INITDB_ROOT_PASSWORD=UDJMgKsbhC7ulyjWk mongo\n\ndocker run -d -p 37017:27017 --name mongo \\\n    -e MONGO_INITDB_ROOT_USERNAME=e700191fad1c \\\n    -e MONGO_INITDB_ROOT_PASSWORD=5caee23e86 \\\n    mongo:latest\n\ndocker exec -it mongo \\\n    mongo -u e700191fad1c \\\n        -p 5caee23e86 \\\n        --authenticationDatabase admin\n\n8.210.238.93:37017\n\ndocker exec -it mongo mongo\n\nscp -i /Users/hemiao/pem/me.pem /Users/hemiao/dockermongo/backups/meterinfos.json root@8.210.238.93:/root/energydb/backups\nmongoimport -d swire -c meterinfos --file /backups/meterinfos.json --drop\nmongoimport --host 8.210.238.93 --port 37017 -u OjE1NTU2ND -p E4MTE5MjI2M3 -d swire -c meterinfos --file /backups/meterinfos.json --drop\n')])])]),e("h3",{attrs:{id:"kafka-sync-mongo"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kafka-sync-mongo"}},[s._v("#")]),s._v(" kafka_sync_mongo")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bash")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -i /Users/hemiao/pem/me.pem root@8.210.238.93\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" kafka_sync_mongo\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -i /Users/hemiao/pem/me.pem /Users/hemiao/swire/kafka_sync_mongo/Dockerfile root@8.210.238.93:/root/kafka_sync_mongo\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -i /Users/hemiao/pem/me.pem /Users/hemiao/swire/kafka_sync_mongo/package.json root@8.210.238.93:/root/kafka_sync_mongo\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -i /Users/hemiao/pem/me.pem -r /Users/hemiao/swire/kafka_sync_mongo/src root@8.210.238.93:/root/kafka_sync_mongo\n\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" kafka_sync_mongo\ndocker build -t joe/kafka_sync_mongo:1.0.0 "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\ndocker run -d -v /"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v('"')]),s._v("/src:/server/src --network mega-net --name kafka_sync_mongo -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_ENV")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("server joe/kafka_sync_mongo:1.0.0\n")])])]),e("h3",{attrs:{id:"energy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#energy"}},[s._v("#")]),s._v(" energy")]),s._v(" "),e("h3",{attrs:{id:"else"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#else"}},[s._v("#")]),s._v(" else")]),s._v(" "),e("ul",[e("li",[s._v("check-mongo-online")]),s._v(" "),e("li",[s._v("check-mongo-local")])])])}),[],!1,null,null,null);a.default=n.exports}}]);